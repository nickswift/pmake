#!/usr/bin/perl 
use strict;
use warnings;
use Cwd;

use lib cwd();

# imports
use Getopt::Std;
use Modules::Helpers;
use Modules::Files;
use Modules::SyntaxTree;
use Modules::Makefiles;

# use getopts in the canonical fashion
my %opts;
getopts('dnf:', \%opts);

my $debug_mode = (exists $opts{'d'}) ? 1          : 0;
my $nex_mode   = (exists $opts{'n'}) ? 1          : 0;
my $makefile   = (exists $opts{'f'}) ? $opts{'f'} : 'Makefile';

# set debug flag
Modules::Helpers::set_debug($debug_mode);

# Read selected makefile into a string and parse it
my $mf_contents = Modules::Files::read_to_string($makefile);
my $targ_root   = Modules::Makefiles::parse($mf_contents);

print_mf_tree($targ_root);

# TODO: interpret root node -- use it to compile someone's stupid bullshit.

# get targets
# for my $target (@ARGV) {
# }